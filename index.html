<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LSMD ‚Ä¢ Ausbilder Checkliste</title>

  <style>
    :root{
      --bg:#070d14;
      --bg2:#07131a;
      --text:#dff9ff;
      --muted:rgba(223,249,255,.68);
      --accent:#00ffc8;
      --accent2:#00aaff;
      --warn:#ffcc66;
      --stroke:rgba(0,255,200,.16);
      --shadow:0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(0,255,200,.12), transparent 55%),
        radial-gradient(900px 600px at 90% 25%, rgba(0,170,255,.10), transparent 55%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;
    }
    .bg-grid{
      position:fixed; inset:0;
      background-image:
        linear-gradient(rgba(0,255,200,.035) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,200,.035) 1px, transparent 1px);
      background-size: 64px 64px;
      opacity:.55;
      pointer-events:none;
      z-index:-3;
    }
    .bg-glow{
      position:fixed; width:560px; height:560px; border-radius:999px;
      filter: blur(80px);
      opacity:.28;
      pointer-events:none;
      z-index:-2;
    }
    .bg-glow-a{ left:-160px; top:80px; background:rgba(0,255,200,.45); }
    .bg-glow-b{ right:-220px; top:140px; background:rgba(0,170,255,.38); }

    .topbar{
      display:flex; justify-content:space-between; align-items:center;
      padding:18px 26px;
      background: rgba(255,255,255,.03);
      border-bottom: 1px solid rgba(0,255,200,.12);
      backdrop-filter: blur(14px);
      position:sticky; top:0; z-index:10;
    }
    .brand{display:flex;align-items:center;gap:12px;}
    .brand-dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--accent);
      box-shadow: 0 0 12px rgba(0,255,200,.9);
      animation: dotPulse 1.6s infinite;
    }
    .brand-title{font-weight:900;}
    .brand-subtitle{font-size:12px;color:var(--muted);margin-top:2px;}
    .topbar-right{display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
    .chip{
      display:flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px;
      background:rgba(0,255,200,.06);
      border:1px solid rgba(0,255,200,.18);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      user-select:none;
      white-space:nowrap;
    }
    .chip-text{font-size:12px;color:rgba(223,249,255,.86);letter-spacing:.25px;}
    .status-dot{
      width:8px;height:8px;border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 10px rgba(0,255,200,.9);
      animation: dotPulse 1.4s infinite;
    }
    .heartbeat-chip{
      background:rgba(0,170,255,.06);
      border-color:rgba(0,170,255,.18);
    }
    .ekg{width:120px;height:22px;opacity:.95}
    .ekg polyline{
      fill:none;
      stroke:var(--accent);
      stroke-width:2;
      stroke-linecap:round;
      stroke-linejoin:round;
      stroke-dasharray:260;
      stroke-dashoffset:260;
      animation: ekgMove 2.4s linear infinite;
    }

    .hero{padding:30px 18px 10px;}
    .hero-card{
      max-width:1200px; margin:0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid rgba(0,255,200,.14);
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hero-head{
      display:flex; justify-content:space-between; gap:22px;
      padding:26px;
      border-bottom:1px solid rgba(0,255,200,.10);
    }
    .hero-title h1{
      font-size:30px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .hero-title p{margin-top:8px;color:var(--muted);max-width:660px;line-height:1.45;}
    .hero-controls{display:grid; grid-template-columns:1fr 1fr; gap:12px; min-width:360px;}
    .field label{font-size:12px;color:var(--muted);margin-bottom:6px;display:block;}
    .input{
      width:100%; padding:11px 12px;
      border-radius:14px;
      border:1px solid rgba(0,255,200,.16);
      background: rgba(0,0,0,.20);
      color:var(--text);
      outline:none;
      transition:.2s;
    }
    .input:focus{border-color:rgba(0,255,200,.45); box-shadow:0 0 0 4px rgba(0,255,200,.08);}

    .stats{
      display:grid; grid-template-columns:repeat(4,1fr);
      gap:14px; padding:18px 26px 10px;
    }
    .stat-card{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(0,255,200,.12);
      border-radius:18px;
      padding:14px;
      display:flex; gap:12px; align-items:center;
      transition:.22s;
      min-height:72px;
    }
    .stat-card:hover{border-color:rgba(0,255,200,.28); transform:translateY(-2px); box-shadow:0 18px 40px rgba(0,0,0,.35);}
    .stat-icon{
      width:40px;height:40px;border-radius:14px;
      display:grid;place-items:center;
      background: rgba(0,255,200,.08);
      border:1px solid rgba(0,255,200,.16);
      font-size:18px;
    }
    .stat-label{font-size:12px;color:var(--muted)}
    .stat-value{font-size:22px;font-weight:900;margin-top:2px}

    .toolbar{
      display:grid;
      grid-template-columns: 1.1fr 1fr auto;
      gap:14px;
      padding:18px 26px 26px;
      align-items:end;
    }
    .search-wrap{position:relative;}
    .search{
      width:100%;
      padding:12px 14px 12px 38px;
      border-radius:16px;
      border:1px solid rgba(0,255,200,.14);
      background: rgba(0,0,0,.18);
      color:var(--text);
      outline:none;
    }
    .search-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:rgba(223,249,255,.55);}
    .progress-wrap{
      background: rgba(0,0,0,.16);
      border:1px solid rgba(0,255,200,.12);
      border-radius:18px;
      padding:12px 14px;
    }
    .progress-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .muted{color:var(--muted);font-size:12px}
    .progress-value{font-weight:900}
    .progress-bar{
      width:100%; height:10px; border-radius:999px;
      background: rgba(255,255,255,.06);
      overflow:hidden;
      border:1px solid rgba(0,255,200,.10);
    }
    .progress-fill{
      height:100%; width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow:0 0 18px rgba(0,255,200,.35);
      transition: width .25s ease;
    }
    .progress-hint{margin-top:10px;font-size:12px;color:var(--muted);}

    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .btn{
      padding:11px 12px;
      border-radius:14px;
      border:1px solid rgba(0,255,200,.16);
      background: rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      transition:.18s;
    }
    .btn:hover{transform:translateY(-1px); border-color:rgba(0,255,200,.34); box-shadow:0 14px 30px rgba(0,0,0,.30);}
    .btn.primary{background: linear-gradient(90deg, rgba(0,255,200,.22), rgba(0,170,255,.20));}
    .btn.success{background: linear-gradient(90deg, rgba(0,255,200,.28), rgba(0,255,130,.18));}
    .btn.ghost{background: rgba(0,0,0,.18);}

    .container{padding:10px 18px 60px;}
    .grid{
      max-width:1200px; margin:0 auto;
      display:grid; grid-template-columns:repeat(4,1fr);
      gap:16px;
    }
    .card{
      background: rgba(255,255,255,.03);
      border:1px solid rgba(0,255,200,.12);
      border-radius:22px;
      box-shadow: 0 16px 45px rgba(0,0,0,.42);
      overflow:hidden;
      transition:.22s;
    }
    .card:hover{transform: translateY(-3px);border-color:rgba(0,255,200,.28);}
    .card-head{
      display:flex; justify-content:space-between; align-items:flex-start;
      padding:16px 16px 12px;
      border-bottom:1px solid rgba(0,255,200,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.16), transparent);
    }
    .tag{
      font-size:11px;
      color:rgba(223,249,255,.9);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,255,200,.16);
      background: rgba(0,255,200,.06);
    }
    .tag-high{border-color: rgba(255,107,107,.28); background: rgba(255,107,107,.08);}
    .list{padding:14px 16px 16px;}
    .item{
      display:flex; align-items:center; gap:10px;
      padding:10px 10px;
      border-radius:14px;
      cursor:pointer;
      transition:.14s;
      border:1px solid transparent;
    }
    .item:hover{background: rgba(255,255,255,.03); border-color: rgba(0,255,200,.12);}
    .item input{accent-color:var(--accent); cursor:pointer; width:16px; height:16px}

    .note{
      margin-top:12px;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(0,255,200,.14);
      background: rgba(0,0,0,.18);
    }
    .note-title{font-size:12px;font-weight:900}
    .note-text{font-size:12px;color:var(--muted);margin-top:4px;line-height:1.35}

    .toast{
      position:fixed; right:18px; bottom:18px;
      width:min(360px, calc(100% - 36px));
      transform: translateY(24px);
      opacity:0;
      pointer-events:none;
      transition:.22s;
      z-index:200;
    }
    .toast.show{transform: translateY(0); opacity:1;}
    .toast-inner{
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(0,255,200,.20);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(14px);
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    .toast-title{font-weight:900}
    .toast-text{margin-top:4px;color:var(--muted);font-size:12px}

    .footer{
      padding:26px 12px 34px;
      display:flex;
      justify-content:center;
      color:rgba(223,249,255,.55);
    }
    .footer-inner{display:flex;gap:10px;align-items:center;font-size:12px;}
    .sep{opacity:.45}

    @media (max-width:1100px){
      .stats{grid-template-columns:repeat(2,1fr);}
      .grid{grid-template-columns:repeat(2,1fr);}
      .toolbar{grid-template-columns:1fr;}
      .actions{justify-content:flex-start;}
      .hero-controls{min-width:unset;grid-template-columns:1fr;}
      .hero-head{flex-direction:column;}
    }
    @media (max-width:640px){
      .grid{grid-template-columns:1fr;}
      .topbar{padding:14px 14px;}
      .hero{padding:18px 12px 10px;}
      .container{padding:10px 12px 60px;}
    }

    @keyframes ekgMove{0%{stroke-dashoffset:260}100%{stroke-dashoffset:0}}
    @keyframes dotPulse{0%{transform:scale(1);opacity:.75}50%{transform:scale(1.18);opacity:1}100%{transform:scale(1);opacity:.75}}
  </style>
</head>

<body>
  <div class="bg-grid"></div>
  <div class="bg-glow bg-glow-a"></div>
  <div class="bg-glow bg-glow-b"></div>

  <header class="topbar">
    <div class="brand">
      <span class="brand-dot"></span>
      <div>
        <div class="brand-title">LSMD ‚Ä¢ Ausbilder Checkliste</div>
        <div class="brand-subtitle">Medical Department ‚Ä¢ Internes System</div>
      </div>
    </div>

    <div class="topbar-right">
      <div class="chip"><span class="chip-text" id="clock">--:--:--</span></div>

      <div class="chip heartbeat-chip">
        <svg class="ekg" viewBox="0 0 120 32">
          <polyline points="0,16 18,16 24,8 30,26 36,16 54,16 60,12 66,20 72,16 120,16"></polyline>
        </svg>
        <span class="chip-text"><span id="bpm">78</span> BPM</span>
      </div>

      <div class="chip">
        <span class="status-dot"></span>
        <span class="chip-text">MEDICAL SYSTEM ‚Ä¢ ONLINE</span>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="hero-card">
      <div class="hero-head">
        <div class="hero-title">
          <h1>Digitale Einstellungs-Checkliste</h1>
          <p>Standardisiertes Vorgehen f√ºr Bewerbungen & Einstellungen ‚Äì strukturiert, nachvollziehbar, sauber dokumentiert.</p>
        </div>

        <div class="hero-controls">
          <div class="field">
            <label for="trainerName">Aktiver Ausbilder</label>
            <input id="trainerName" class="input" type="text" placeholder="Name des Ausbilders‚Ä¶" />
          </div>
          <div class="field">
            <label for="candidateName">Bewerber</label>
            <input id="candidateName" class="input" type="text" placeholder="Name des Bewerbers‚Ä¶" />
          </div>
        </div>
      </div>

      <div class="stats">
        <div class="stat-card"><div class="stat-icon">üßæ</div><div><div class="stat-label">Heute</div><div class="stat-value" id="statToday">0</div></div></div>
        <div class="stat-card"><div class="stat-icon">üì¶</div><div><div class="stat-label">Insgesamt</div><div class="stat-value" id="statTotal">0</div></div></div>
        <div class="stat-card"><div class="stat-icon">üü°</div><div><div class="stat-label">Offen</div><div class="stat-value" id="statOpen">0</div></div></div>
        <div class="stat-card"><div class="stat-icon">‚úÖ</div><div><div class="stat-label">Abgeschlossen</div><div class="stat-value" id="statDone">Nein</div></div></div>
      </div>

      <div class="toolbar">
        <div class="search-wrap">
          <span class="search-icon">‚åï</span>
          <input id="search" class="search" type="text" placeholder="Checkliste durchsuchen (z.B. Funk, Rang, Ausweis‚Ä¶)" />
        </div>

        <div class="progress-wrap">
          <div class="progress-head">
            <span class="muted">Fortschritt</span>
            <span class="progress-value"><span id="progressPercent">0</span>%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
          <div class="progress-hint" id="progressHint">Noch nichts abgehakt.</div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="btnReset" type="button">Zur√ºcksetzen</button>
          <button class="btn primary" id="btnSave" type="button">Speichern</button>
          <button class="btn success" id="btnFinish" type="button">Einstellung abschlie√üen</button>
        </div>
      </div>
    </div>
  </section>

  <main class="container">
    <section class="grid">

      <article class="card">
        <div class="card-head">
          <div>
            <h2>Vor der Bewerbung</h2>
            <div class="muted" style="margin-top:4px">Pr√ºfen & Freigeben</div>
          </div>
          <span class="tag tag-high">PRIO</span>
        </div>
        <div class="list">
          <label class="item"><input type="checkbox" data-key="pre_license" /> F√ºhrerscheine kontrollieren</label>
          <label class="item"><input type="checkbox" data-key="pre_files" /> Aktencheck + Rechnungen + Durchsuchen</label>
          <label class="item"><input type="checkbox" data-key="pre_record" /> Strafakte pr√ºfen (3+ Tage straffrei)</label>
          <div class="note"><div class="note-title">Hinweis</div><div class="note-text">Rechnungen nicht √§lter als 3 Tage akzeptieren.</div></div>
        </div>
      </article>

      <article class="card">
        <div class="card-head">
          <div>
            <h2>Vorstellungsgespr√§ch</h2>
            <div class="muted" style="margin-top:4px">Einweisung & Regeln</div>
          </div>
          <span class="tag">~2 MIN</span>
        </div>
        <div class="list">
          <label class="item"><input type="checkbox" data-key="intro_duty" /> Auf Dienstpflicht hinweisen (18‚Äì23 Uhr)</label>
          <label class="item"><input type="checkbox" data-key="intro_corruption" /> Korruption erfragen, erkl√§ren & Fragen stellen</label>
          <label class="item"><input type="checkbox" data-key="intro_discord" /> Auf MD Discord einladen</label>
        </div>
      </article>

      <article class="card">
        <div class="card-head">
          <div>
            <h2>Discord & Dokumentation</h2>
            <div class="muted" style="margin-top:4px">Eintragen & kontrollieren</div>
          </div>
          <span class="tag">5‚Äì10 MIN</span>
        </div>
        <div class="list">
          <label class="item"><input type="checkbox" data-key="dc_post" /> Einstellung posten (Format beachten)</label>
          <label class="item"><input type="checkbox" data-key="dc_log" /> Kontrolle im Log-Channel durchf√ºhren</label>
          <label class="item"><input type="checkbox" data-key="dc_rank" /> Rang eintragen</label>
          <label class="item"><input type="checkbox" data-key="dc_id" /> Ausweis eintragen/erstellen</label>
          <label class="item"><input type="checkbox" data-key="dc_channels" /> Wichtige Channels zeigen & erkl√§ren</label>
        </div>
      </article>

      <article class="card">
        <div class="card-head">
          <div>
            <h2>In RP</h2>
            <div class="muted" style="margin-top:4px">Setup & Onboarding</div>
          </div>
          <span class="tag">~7 MIN</span>
        </div>
        <div class="list">
          <label class="item"><input type="checkbox" data-key="rp_job" /> Job geben</label>
          <label class="item"><input type="checkbox" data-key="rp_jobmenu" /> Job-Men√º erkl√§ren</label>
          <label class="item"><input type="checkbox" data-key="rp_dispatch" /> Dispatch-Men√º binden & erkl√§ren</label>
          <label class="item"><input type="checkbox" data-key="rp_radio" /> Funk einrichten & erkl√§ren</label>
          <label class="item"><input type="checkbox" data-key="rp_clothes" /> Umziehen (Fraktionsumkleide im EG)</label>
          <label class="item"><input type="checkbox" data-key="rp_gear" /> Ausr√ºsten (z.B. Medkits/Defis)</label>
          <label class="item"><input type="checkbox" data-key="rp_places" /> Wichtige √ñrtlichkeiten zeigen</label>
        </div>
      </article>

    </section>
  </main>

  <div class="toast" id="toast" aria-live="polite" aria-atomic="true">
    <div class="toast-inner">
      <div class="toast-title" id="toastTitle">Hinweis</div>
      <div class="toast-text" id="toastText">‚Ä¶</div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-inner">
      <span>LSMD Intern ‚Ä¢ Ausbilder-System ¬© 2026</span>
      <span class="sep">‚Ä¢</span>
      <span>Made by Bonez</span>
    </div>
  </footer>

 <script>
(() => {
  "use strict";

  const $ = (id) => document.getElementById(id);

  // ---- Elemente (alle optional, Script crasht nie) ----
  const els = {
    trainerName: $("trainerName"),
    candidateName: $("candidateName"),
    search: $("search"),
    progressFill: $("progressFill"),
    progressPercent: $("progressPercent"),
    progressHint: $("progressHint"),
    statToday: $("statToday"),
    statTotal: $("statTotal"),
    statOpen: $("statOpen"),
    statDone: $("statDone"),
    btnReset: $("btnReset"),
    btnSave: $("btnSave"),
    btnFinish: $("btnFinish"),
    toast: $("toast"),
    toastTitle: $("toastTitle"),
    toastText: $("toastText"),
    clock: $("clock"),
    bpm: $("bpm"),
  };

  // ---- LocalStorage Keys (v4 => alte kaputte Daten egal) ----
  const LS = {
    trainer: "lsmd_trainer_name_v4",
    candidate: "lsmd_candidate_name_v4",
    checks: "lsmd_checks_v4",
    counters: "lsmd_counters_v4",
  };

  // ---- Google Sheets Webhook (DEINE URL EINF√úGEN) ----
  const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbz8-g83IBg2giMRVPIoxn0nsZUUhHqzLRavLSt4Qk9EZQ6zuerMlJCrMBorANjcnp40Bg/exec";

  // ---- Helpers ----
  const safeParse = (s, fallback) => {
    try {
      if (!s) return fallback;
      const v = JSON.parse(s);
      return v && typeof v === "object" ? v : fallback;
    } catch {
      return fallback;
    }
  };

  const nowISO = () => new Date().toISOString();

  const todayKey = () => {
    const d = new Date();
    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
  };

  function showToast(title, msg) {
    if (!els.toast || !els.toastTitle || !els.toastText) return;
    els.toastTitle.textContent = title;
    els.toastText.textContent = msg;
    els.toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => els.toast.classList.remove("show"), 2200);
  }

  function getCheckboxes() {
    return Array.from(document.querySelectorAll('input[type="checkbox"][data-key]'));
  }

  function getState() {
    return safeParse(localStorage.getItem(LS.checks), {});
  }

  function setState(state) {
    try {
      localStorage.setItem(LS.checks, JSON.stringify(state || {}));
    } catch {
      // ignore (storage voll/blockiert)
    }
  }

  function applyStateToUI() {
    const state = getState();
    for (const cb of getCheckboxes()) {
      const key = cb?.dataset?.key;
      cb.checked = !!(key && state[key]);
    }
  }

  function recomputeProgress() {
    const cbs = getCheckboxes();
    const total = cbs.length;
    const done = cbs.filter((cb) => cb.checked).length;
    const percent = total ? Math.round((done / total) * 100) : 0;
    const open = total - done;

    if (els.progressPercent) els.progressPercent.textContent = String(percent);
    if (els.progressFill) els.progressFill.style.width = `${percent}%`;
    if (els.statOpen) els.statOpen.textContent = String(open);
    if (els.statDone) els.statDone.textContent = percent === 100 ? "Ja" : "Nein";

    if (els.progressHint) {
      if (done === 0) els.progressHint.textContent = "Noch nichts abgehakt.";
      else if (percent < 100) els.progressHint.textContent = `${open} Punkt(e) noch offen.`;
      else els.progressHint.textContent = "Alles erledigt ‚úÖ";
    }

    return { total, done, percent, open };
  }

  function getCounters() {
    const base = { total: 0, todayCount: 0, todayDate: todayKey() };
    const data = safeParse(localStorage.getItem(LS.counters), base);

    if (data.todayDate !== todayKey()) {
      data.todayDate = todayKey();
      data.todayCount = 0;
    }

    data.total = Number(data.total) || 0;
    data.todayCount = Number(data.todayCount) || 0;

    return data;
  }

  function setCounters(c) {
    localStorage.setItem(LS.counters, JSON.stringify(c));
    if (els.statTotal) els.statTotal.textContent = String(c.total);
    if (els.statToday) els.statToday.textContent = String(c.todayCount);
  }

  // ---- Logging in Google Sheet (crash-sicher) ----
  async function logToSheet({ trainer, candidate, progress }) {
    // Wenn du die URL noch nicht eingetragen hast, skippen wir still
    if (!WEBHOOK_URL || WEBHOOK_URL.includes("HIER_DEINE_")) return;

    try {
      await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          trainer,
          candidate,
          progress,
          timestamp: nowISO(),
          page: location.href
        }),
      });
    } catch (e) {
      console.warn("Log to Sheet failed:", e);
      // Website soll trotzdem funktionieren
    }
  }

  // ---- Save / Reset / Finish ----
  function saveAll() {
    if (els.trainerName) localStorage.setItem(LS.trainer, (els.trainerName.value || "").trim());
    if (els.candidateName) localStorage.setItem(LS.candidate, (els.candidateName.value || "").trim());

    const state = {};
    for (const cb of getCheckboxes()) {
      const key = cb?.dataset?.key;
      if (key) state[key] = !!cb.checked;
    }
    setState(state);

    showToast("Gespeichert", "Deine √Ñnderungen wurden gespeichert.");
  }

  function resetAll() {
    for (const cb of getCheckboxes()) cb.checked = false;
    setState({});
    recomputeProgress();
    showToast("Zur√ºckgesetzt", "Alle Punkte wurden entfernt.");
  }

  async function finish() {
    const prog = recomputeProgress();
    const trainer = (els.trainerName?.value || localStorage.getItem(LS.trainer) || "").trim();
    const candidate = (els.candidateName?.value || localStorage.getItem(LS.candidate) || "").trim();

    if (!trainer || !candidate) {
      showToast("Fehlende Angaben", "Bitte Ausbilder + Bewerber eintragen.");
      return;
    }
    if (prog.percent < 100) {
      showToast("Nicht fertig", "Nicht alle Punkte sind abgehakt.");
      return;
    }

    // Counters erh√∂hen
    const c = getCounters();
    c.total += 1;
    c.todayCount += 1;
    c.todayDate = todayKey();
    setCounters(c);

    showToast("Abgeschlossen ‚úÖ", `${candidate} wurde von ${trainer} eingestellt.`);

    // Log nach extern (Google Sheet)
    await logToSheet({ trainer, candidate, progress: prog.percent });
  }

  // ---- Suche ----
  function applySearch(q) {
    q = (q || "").toLowerCase().trim();
    const items = Array.from(document.querySelectorAll(".item"));
    const cards = Array.from(document.querySelectorAll(".card"));

    if (!q) {
      items.forEach((i) => (i.style.display = ""));
      cards.forEach((c) => (c.style.display = ""));
      return;
    }

    items.forEach((item) => {
      const t = (item.textContent || "").toLowerCase();
      item.style.display = t.includes(q) ? "" : "none";
    });

    cards.forEach((card) => {
      const visible = Array.from(card.querySelectorAll(".item")).some((i) => i.style.display !== "none");
      card.style.display = visible ? "" : "none";
    });
  }

  // ---- Uhr + BPM ----
  function tickClock() {
    if (!els.clock) return;
    const d = new Date();
    els.clock.textContent =
      `${String(d.getHours()).padStart(2, "0")}:${String(d.getMinutes()).padStart(2, "0")}:${String(d.getSeconds()).padStart(2, "0")}`;
  }

  let bpmVal = 78;
  function tickBpm() {
    if (!els.bpm) return;
    const target = 72 + Math.round(Math.random() * 14);
    bpmVal = Math.round(bpmVal + (target - bpmVal) * 0.35);
    els.bpm.textContent = String(bpmVal);
  }

  // ---- Events ----
  function bind() {
    // Checkbox -> sofort speichern & progress
    for (const cb of getCheckboxes()) {
      cb.addEventListener("change", () => {
        const state = getState();
        const key = cb?.dataset?.key;
        if (key) state[key] = !!cb.checked;
        setState(state);
        recomputeProgress();
      });
    }

    // Inputs -> autosave (debounced)
    let t = null;
    const autoSave = () => {
      clearTimeout(t);
      t = setTimeout(saveAll, 250);
    };
    els.trainerName?.addEventListener("input", autoSave);
    els.candidateName?.addEventListener("input", autoSave);

    // Search
    els.search?.addEventListener("input", (e) => applySearch(e.target.value));

    // Buttons
    els.btnSave?.addEventListener("click", saveAll);
    els.btnReset?.addEventListener("click", resetAll);
    els.btnFinish?.addEventListener("click", finish);
  }

  // ---- Init ----
  function init() {
    // Namen laden
    if (els.trainerName) els.trainerName.value = localStorage.getItem(LS.trainer) || "";
    if (els.candidateName) els.candidateName.value = localStorage.getItem(LS.candidate) || "";

    // Counters laden
    setCounters(getCounters());

    // Checkbox State laden
    applyStateToUI();

    // Progress initial
    recomputeProgress();

    // Events binden
    bind();

    // Uhr/BPM starten
    tickClock(); setInterval(tickClock, 1000);
    tickBpm(); setInterval(tickBpm, 2000);

    showToast("System bereit", "Alles l√§uft ‚úÖ");
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
})();
</script>

</body>
</html>
